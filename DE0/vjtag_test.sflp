
// VirtualJTAGƒeƒXƒg

%i "seg7_ctrl.h"
%i "vjtag_uart.h"

circuit vjtag_test
{
	output HEX0<7>, HEX1<7>, HEX2<7>, HEX3<7>;
	seg7_ctrl seg7_0, seg7_1, seg7_2, seg7_3;
	sel seg<16>;
	output LEDG<10>;

	vjtag_uart vjtag;

	reg_wr sum<8>;
	mem ram[32768]<8>;
	reg_wr ram_dout<8>, adrs<15>;


	HEX3 = seg7_3.con(seg<15:12>).oSEG;
	HEX2 = seg7_2.con(seg<11: 8>).oSEG;
	HEX1 = seg7_1.con(seg< 7: 4>).oSEG;
	HEX0 = seg7_0.con(seg< 3: 0>).oSEG;

	seg = 0x00 || sum;

	LEDG = adrs<9:0>;

	instruct vjtag.init_recv par{
		sum := 0x00;
		adrs := 0;
	}

	instruct vjtag.recv par{
		ram[adrs] := vjtag.recv_data;
		adrs++;
		sum += vjtag.recv_data;
	}

	instruct vjtag.init_send par{
		adrs := 0;
	}

	reg_wr send_set;
	instruct vjtag.send par{
		ram_dout := ram[adrs];
		adrs++;
		send_set := 0b1;
	}
	if(send_set){
		vjtag.send_set(ram_dout);
		send_set := 0b0;
	}

}
